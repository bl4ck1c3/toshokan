(function ($) {

  $(function () {

  	var openurl_link = $(".Z3988").attr("title");
  	var umlaut_base = '<%= Toshokan::Application.config.umlaut[:url] %>';
  	var updater = new Umlaut.HtmlUpdater(umlaut_base , openurl_link);
    
    var fulltext_header = ".fulltext-header";
    var fulltext_selector = ".fulltext";

    var spin_opts = {
      length: 5,
      width: 3,
      radius: 6,
    };
    
    $(fulltext_header).append().spin(spin_opts);
    updater.add_section_target({
      umlaut_section_id: "fulltext",
      selector: fulltext_selector,
      before_update: function(html, count) {
        $(html).html($(html).find(".response_item"));
        $(html).find(".response_notes").remove();
        if(count==0) {
          $(html).html("<%= I18n.t('toshokan.tools.not_available') %>");
        }        
        $(fulltext_header).spin(false);
      }
    });
    updater.update();
	});
})(jQuery);
